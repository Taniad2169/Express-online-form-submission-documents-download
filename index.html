<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Express Capital Associates Application</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; padding: 20px; color: #f2f4f5; background-color: #2f3746; }
        .container { max-width: 800px; margin: 0 auto; line-height: 1.6; }
        .header { text-align: center; border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-bottom: 20px; }
        h1 { font-size: 24px; color: white !important; }
        h2 { font-size: 20px; margin-top: 30px; border-bottom: 1px solid #ccc; padding-bottom: 5px; color: #f2f4f5; }
        .form-section { background-color: #2f3746; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .form-row { display: flex; flex-wrap: wrap; margin-bottom: 15px; }
        .form-group { flex: 1 1 45%; margin-right: 10px; }
        .form-group:last-child { margin-right: 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="date"], select, textarea {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            color: #333;
        }
        input[type="radio"] { margin-right: 5px; }
        .checkbox-group label { font-weight: normal; display: inline; }
        .checkbox-group { margin-bottom: 15px; }
        .hidden { display: none; }
        .section-title { font-size: 18px; font-weight: bold; color: #f2f4f5; margin-top: 20px; }
        .highlight { color: #d68019; }
        .fax-header { font-weight: bold; text-align: center; font-size: 18px; margin-bottom: 15px; }
        .disclosure-container { background-color: white; color: #2f3746; border: 1px solid #ccc; padding: 15px; max-height: 200px; overflow-y: scroll; font-size: 12px; margin-bottom: 15px; }
        .buttons { text-align: center; margin-top: 20px; }
        button, .anchor-btn {
            background-color: #1a4d2e;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s;
        }
        button:hover, .anchor-btn:hover { background-color: #2b6a48; }
        .signature-pad {
            border: 1px solid #f2f4f5;
            border-radius: 4px;
            width: 100%;
            height: 150px;
            background-color: #fff;
            margin-top: 10px;
            cursor: not-allowed;
        }
        .signature-pad-container { text-align: center; }
        .yellow-highlight {
            background-color: yellow;
            font-weight: bold;
            padding: 2px 4px;
            border-radius: 4px;
            display: inline-block;
        }
        .document-upload-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .document-upload-row .checkbox-label {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        .document-upload-row .checkbox-label input[type="checkbox"] {
            margin-right: 10px;
        }
        .signature-error {
            color: #d9534f;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: none;
        }
        .signature-error button {
            background-color: #d9534f;
            margin-top: 10px;
        }
        .signature-error button:hover {
            background-color: #c9302c;
        }
        .button-row {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        @media (max-width: 600px) {
            .form-group { flex: 1 1 100%; margin-right: 0; }
            .form-row { flex-direction: column; }
            .button-row {
                flex-direction: column;
                align-items: center;
            }
            .button-row button, .button-row .anchor-btn {
                width: 100%;
                margin: 5px 0;
            }
        }
        @media print {
            body {
                background-color: white;
                margin: 0;
            }
            .header, .buttons, .anchor-btn, .section-title, .document-uploads {
                display: none;
            }
            .form-section, .signature-section {
                box-shadow: none;
                background-color: white;
            }
            .container {
                max-width: none;
                width: 100%;
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Express Capital Network Associates</h1>
        </header>

        <form id="unifiedForm" action="https://formspree.io/f/movnqkgb" method="POST" enctype="multipart/form-data">
                <div class="section-title"><span class="highlight">Additional Documents Required</span></div>
                <div class="document-uploads">
                    <div class="document-upload-row">
                        <label class="checkbox-label">
                            <input type="checkbox" required /> Copy of driver's license
                        </label>
                        <input type="file" id="driversLicenseUpload" name="driversLicenseUpload" required>
                    </div>
                    <div class="document-upload-row">
                        <label class="checkbox-label">
                            <input type="checkbox" required /> 4 recent months of business bank statements
                        </label>
                        <input type="file" id="bankStatementsUpload" name="bankStatementsUpload[]" multiple required>
                    </div>
                    <div class="document-upload-row">
                        <label class="checkbox-label">
                            <input type="checkbox" required /> Copy of a voided check
                        </label>
                        <input type="file" id="voidedCheckUpload" name="voidedCheckUpload" required>
                    </div>
                    <div class="document-upload-row">
                        <label class="checkbox-label">
                            <input type="checkbox" /> Miscellaneous documents
                        </label>
                        <input type="file" id="miscellaneousUpload" name="miscellaneousUpload[]" multiple>
                    </div>
                </div>
            <section id="signature" class="form-section">
                <h2>Signature *</h2>
                
                <div class="signature-error" id="signatureError">
                    <h3>Signature Error</h3>
                    You must agree to the terms and conditions before signing the application.<br>
                    Please check the agreement box first.
                    <div style="text-align: center; margin-top: 10px;">
                        <button type="button" onclick="document.getElementById('signatureError').style.display = 'none'">OK, I Understand</button>
                    </div>
                </div>
                
                <label for="disclosure">Disclosure / Terms & Conditions</label>
                <div class="disclosure-container" id="disclosure">
                    By signing above, each of the above listed business and business owner/officer (individually and collectively, "you") authorize Express Capital Network Associates and its agents, banks or financial institutions to obtain an investigative or consumer report from a credit bureau or a credit agency and to investigate the references given on any other statements or data obtained from applicant. You also authorize Express Capital Network Associates to transmit this application form, with any of the foregoing information obtained in connection with this application, to any or all of the Recipients for the foregoing purposes. You also consent to the release, by any creditor or financial institution, of any information relating to any of you, to Express Capital Network Associates and to each of the Recipients, on its own behalf. I am providing my business cell-phone and business e-mail address and hereby consent to the receipt of correspondence/messages regarding transactions with Express Capital Network Associates and/or its affiliates on either medium. I certify that all the information contained herein is complete, true and accurate. Express Capital Network Associate is not a lender or a bank. We do not provide loans or make credit decisions. Our service connects businesses like yours with a network of trusted third-party funding providers who offer Merchant Cash Advances (MCAs) and other commercial financing products.
                    A Merchant Cash Advance (MCA) is a purchase of future receivables, not a loan. It is not subject to the same regulatory requirements as traditional loans and may have different terms and conditions. Please be aware that MCAs may involve higher costs compared to traditional financing options.
                    All funding offers are subject to the individual provider's underwriting and approval processes. Express Capital Network Associate may receive a referral fee or commission if your business is funded through one of our partners. We strongly advise you to consult with a qualified financial advisor to determine if an MCA or any other financing product is suitable for your specific business needs.
                    By submitting this application, you agree to be contacted by phone, SMS, or email regarding commercial financing products, in accordance with our <a href="https://www.expresscapassociates.com/privacy-policy">Privacy Policy</a>.
                </div>
                
                <h3>1. I acknowledge that I have read, understood, and agree to the above document's terms and conditions. *</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="agreement" name="agreement" required> I agree to the terms and conditions</label>
                </div>
                
                <h3>2. Signature *</h3>
                <div class="signature-pad-container">
                    <canvas id="signaturePad" class="signature-pad" style="cursor: not-allowed;"></canvas>
                    <button type="button" id="clearSignature">Clear Signature</button>
                </div>
                
                <div class="button-row">
                    <button type="submit">Submit Application</button>
                </div>
            </section>
        </form>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script>
        // Signature pad logic using signature_pad library
        const canvas = document.getElementById("signaturePad");
        const signaturePad = new SignaturePad(canvas, {
            backgroundColor: 'rgb(255, 255, 255)'
        });
        
        // Show error when trying to sign without agreement - FIXED CODE
        canvas.addEventListener('mousedown', (e) => {
            if (!agreementCheckbox.checked) {
                e.preventDefault();
                document.getElementById('signatureError').style.display = 'block';
                // Scroll to error message
                document.getElementById('signatureError').scrollIntoView({behavior: 'smooth'});
            }
        });
        
        canvas.addEventListener('touchstart', (e) => {
            if (!agreementCheckbox.checked) {
                e.preventDefault();
                document.getElementById('signatureError').style.display = 'block';
                // Scroll to error message
                document.getElementById('signatureError').scrollIntoView({behavior: 'smooth'});
            }
        });
        
        document.getElementById('clearSignature').addEventListener('click', () => {
            signaturePad.clear();
        });

        // Control the signature pad based on the checkbox state
        const agreementCheckbox = document.getElementById('agreement');
        
        // Initial state
        if (!agreementCheckbox.checked) {
            signaturePad.off();
            canvas.style.cursor = 'not-allowed';
        }
        
        agreementCheckbox.addEventListener('change', () => {
            if (agreementCheckbox.checked) {
                signaturePad.on();
                canvas.style.cursor = 'crosshair';
                // Hide error if it was showing
                document.getElementById('signatureError').style.display = 'none';
            } else {
                signaturePad.off();
                signaturePad.clear();
                canvas.style.cursor = 'not-allowed';
            }
        });

        const unifiedForm = document.getElementById('unifiedForm');
        unifiedForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!agreementCheckbox.checked) {
                alert("You must agree to the terms before submitting.");
                document.getElementById('signatureError').style.display = 'block';
                document.getElementById('signatureError').scrollIntoView({behavior: 'smooth'});
                return;
            }

            if (signaturePad.isEmpty()) {
                alert("Please sign the document before submitting.");
                return;
            }

            // Get form data and signature image
            const formData = new FormData(unifiedForm);
            const signatureBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
            formData.append('signature-file', signatureBlob, 'signature.png');

            try {
                const response = await fetch(unifiedForm.action, {
                    method: 'POST',
                    body: formData,
                    headers: { 'Accept': 'application/json' }
                });

                if (response.ok) {
                    alert("Form submitted successfully!");
                    unifiedForm.reset();
                    signaturePad.clear();
                } else {
                    const data = await response.json();
                    if (data && data.errors) {
                        alert("Oops! There was a problem submitting your form. " + data.errors.map(err => err.message).join(", "));
                    } else {
                        alert("Oops! There was a problem submitting your form.");
                    }
                }
            } catch (error) {
                alert("Oops! There was a problem submitting your form.");
            }
        });
        
        // Resize canvas to fit container
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            signaturePad.clear();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
    </script>
</body>
</html>
